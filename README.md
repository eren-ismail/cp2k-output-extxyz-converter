# CP2K to ASE Extended XYZ Converter

This project provides a Python script to convert CP2K output files (`output.out`) into the ASE Extended XYZ format (`output.xyz`).  
The converted data includes:

- Lattice vectors
- Atomic positions
- Atomic forces (converted to eV/Å)
- Total energy (converted to eV)

The script also supports batch processing of all subdirectories in a given base directory and generates a combined `total_output_unit.xyz` file.

The 'total_output_unit.xyz' file serves as a suitable dataset for machine learning-based interatomic applications, such as MACE.

## Features

- Processes `output.out` files generated by CP2K
- Extracts:
  - Lattice vectors
  - Atomic coordinates (Å)
  - Atomic forces (converted from atomic units to eV/Å)
  - Total energy (converted from Hartree to eV)
- Outputs ASE Extended XYZ format for compatibility with visualization and analysis tools
- Recursively processes all subdirectories
- Combines all `output.xyz` files into a single `total_output_unit.xyz`

## Requirements

- Python 3.x
- No additional libraries required (standard library only)

## Usage

### Basic Usage

```bash
python convert_cp2k_to_extendedxyz_units.py
```

By default, the script will process the current directory (`.`), converting any `output.out` files it finds and creating:
- `output.xyz` in each subdirectory
- `total_output_unit.xyz` in the base directory

### Custom Directory

To process a custom base directory, modify this line in the script:

```python
process_all_subdirectories('your_base_directory_here')
```

## Output Format

Example of the first few lines of the Extended XYZ file:

```
<number_of_atoms>
Properties=species:S:1:pos:R:3:force:R:3 energy=<total_energy> Lattice="<lattice_vectors>" pbc="T T T"
Atom1 x y z fx fy fz
Atom2 x y z fx fy fz
...
```

- `energy` in eV
- `forces` in eV/Å
- `Lattice` in Å

## Notes

- Lattice vectors are extracted from lines starting with `CELL| Vector`.
- Atomic coordinates section must match: `MODULE QUICKSTEP: ATOMIC COORDINATES IN angstrom`.
- Atomic forces section must match: `ATOMIC FORCES in [a.u.]`.

### Unit Conversions

- Force: 1 a.u. → 51.422 eV/Å
- Energy: 1 Hartree → 27.211386 eV

## Example Directory Structure

```
project_root/
├── run1/
│   └── output.out
├── run2/
│   └── output.out
└── convert_cp2k_to_extendedxyz_units.py
```

After running the script:

```
project_root/
├── run1/
│   ├── output.out
│   └── output.xyz
├── run2/
│   ├── output.out
│   └── output.xyz
├── total_output_unit.xyz
└── convert_cp2k_to_extendedxyz_units.py
```

## Limitations

- Assumes CP2K output matches the expected format.
- No advanced error handling for incomplete or inconsistent output files.
- No automated unit tests (contributions welcome).

## License

GNU License.
